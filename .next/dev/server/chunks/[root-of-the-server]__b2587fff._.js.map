{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/krish/Downloads/nivara-e-commerce-website/lib/session.ts"],"sourcesContent":["import { cookies } from \"next/headers\"\nimport { SignJWT, jwtVerify } from \"jose\"\n\nconst SECRET_KEY = new TextEncoder().encode(process.env.JWT_SECRET || \"your-secret-key-change-this-in-production\")\n\nexport interface SessionData {\n  userId: number\n  email: string\n  role: string\n}\n\nexport async function createSession(data: SessionData): Promise<string> {\n  return new SignJWT(data).setProtectedHeader({ alg: \"HS256\" }).setIssuedAt().setExpirationTime(\"7d\").sign(SECRET_KEY)\n}\n\nexport async function getSession(): Promise<SessionData | null> {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"session\")?.value\n\n  if (!token) {\n    return null\n  }\n\n  try {\n    const verified = await jwtVerify(token, SECRET_KEY)\n    return verified.payload as SessionData\n  } catch (err) {\n    return null\n  }\n}\n\nexport async function verifyAuth(token: string): Promise<SessionData | null> {\n  try {\n    const verified = await jwtVerify(token, SECRET_KEY)\n    return verified.payload as SessionData\n  } catch (err) {\n    return null\n  }\n}\n\nexport async function deleteSession(): Promise<void> {\n  const cookieStore = await cookies()\n  cookieStore.delete(\"session\")\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AAAA;;;AAEA,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAQ/D,eAAe,cAAc,IAAiB;IACnD,OAAO,IAAI,qNAAO,CAAC,MAAM,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAAG,WAAW,GAAG,iBAAiB,CAAC,MAAM,IAAI,CAAC;AAC3G;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,+LAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,YAAY;IAE1C,IAAI,CAAC,OAAO;QACV,OAAO;IACT;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,yNAAS,EAAC,OAAO;QACxC,OAAO,SAAS,OAAO;IACzB,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,eAAe,WAAW,KAAa;IAC5C,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,yNAAS,EAAC,OAAO;QACxC,OAAO,SAAS,OAAO;IACzB,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,+LAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/krish/Downloads/nivara-e-commerce-website/lib/db.ts"],"sourcesContent":["import { neon } from \"@neondatabase/serverless\"\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL environment variable is not set\")\n}\n\nexport const sql = neon(process.env.DATABASE_URL)\n"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC7B,MAAM,IAAI,MAAM;AAClB;AAEO,MAAM,MAAM,IAAA,mNAAI,EAAC,QAAQ,GAAG,CAAC,YAAY"}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/krish/Downloads/nivara-e-commerce-website/app/api/admin/emails/remove/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\r\nimport { cookies } from \"next/headers\"\r\nimport { verifyAuth } from \"@/lib/session\"\r\nimport { sql } from \"@/lib/db\"\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const cookieStore = await cookies()\r\n    const token = cookieStore.get(\"session\")?.value\r\n\r\n    if (!token) {\r\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n    }\r\n\r\n    const user = await verifyAuth(token)\r\n    if (!user || user.role !== \"admin\") {\r\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n    }\r\n\r\n    const formData = await request.formData()\r\n    const id = formData.get(\"id\") as string\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"Email ID is required\" }, { status: 400 })\r\n    }\r\n\r\n    // Don't allow removal of the last active email\r\n    const activeEmails = await sql`\r\n      SELECT COUNT(*) as count FROM admin_emails WHERE is_active = true\r\n    `\r\n    \r\n    if (activeEmails[0].count <= 1) {\r\n      const emailToRemove = await sql`\r\n        SELECT is_active FROM admin_emails WHERE id = ${Number.parseInt(id)}\r\n      `\r\n      \r\n      if (emailToRemove.length > 0 && emailToRemove[0].is_active) {\r\n        return NextResponse.json({ error: \"Cannot remove the last active email\" }, { status: 400 })\r\n      }\r\n    }\r\n\r\n    await sql`\r\n      DELETE FROM admin_emails\r\n      WHERE id = ${Number.parseInt(id)}\r\n    `\r\n\r\n    return NextResponse.redirect(new URL(\"/admin/emails\", request.url))\r\n  } catch (error: any) {\r\n    console.error(\"[v0] Remove admin email error:\", error)\r\n    return NextResponse.json({ error: \"Failed to remove email\" }, { status: 500 })\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,cAAc,MAAM,IAAA,+LAAO;QACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,YAAY;QAE1C,IAAI,CAAC,OAAO;YACV,OAAO,mMAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,OAAO,MAAM,IAAA,iLAAU,EAAC;QAC9B,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,SAAS;YAClC,OAAO,mMAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,KAAK,SAAS,GAAG,CAAC;QAExB,IAAI,CAAC,IAAI;YACP,OAAO,mMAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAEA,+CAA+C;QAC/C,MAAM,eAAe,MAAM,qKAAG,CAAC;;IAE/B,CAAC;QAED,IAAI,YAAY,CAAC,EAAE,CAAC,KAAK,IAAI,GAAG;YAC9B,MAAM,gBAAgB,MAAM,qKAAG,CAAC;sDACgB,EAAE,OAAO,QAAQ,CAAC,IAAI;MACtE,CAAC;YAED,IAAI,cAAc,MAAM,GAAG,KAAK,aAAa,CAAC,EAAE,CAAC,SAAS,EAAE;gBAC1D,OAAO,mMAAY,CAAC,IAAI,CAAC;oBAAE,OAAO;gBAAsC,GAAG;oBAAE,QAAQ;gBAAI;YAC3F;QACF;QAEA,MAAM,qKAAG,CAAC;;iBAEG,EAAE,OAAO,QAAQ,CAAC,IAAI;IACnC,CAAC;QAED,OAAO,mMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,iBAAiB,QAAQ,GAAG;IACnE,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,mMAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACF"}}]
}