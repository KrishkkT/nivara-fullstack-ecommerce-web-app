{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/krish/Downloads/nivarasilverjewels/app/actions/payment.ts"],"sourcesContent":["\"use server\"\n\nexport async function getRazorpayPublicKey() {\n  // This server action safely returns the public Razorpay key\n  // NEXT_PUBLIC_ keys are safe to expose, but using server action is more secure\n  return process.env.NEXT_PUBLIC_RAZORPAY_KEY_ID || \"\"\n}\n"],"names":[],"mappings":";;;;;;;AAEO,eAAe;IACpB,4DAA4D;IAC5D,+EAA+E;IAC/E,OAAO,iEAA2C;AACpD;;;IAJsB;;AAAA,kRAAA"}},
    {"offset": {"line": 25, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/krish/Downloads/nivarasilverjewels/lib/db.ts"],"sourcesContent":["import { neon } from \"@neondatabase/serverless\"\n\n// Lazy initialization - only check for DATABASE_URL when it's actually used\nexport const sql = ((...args: any[]) => {\n  if (!process.env.DATABASE_URL) {\n    throw new Error(\"DATABASE_URL environment variable is not set\")\n  }\n  \n  const sqlInstance = neon(process.env.DATABASE_URL)\n  // @ts-ignore\n  return sqlInstance(...args)\n}) as ReturnType<typeof neon>"],"names":[],"mappings":";;;;AAAA;;AAGO,MAAM,MAAO,CAAC,GAAG;IACtB,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;QAC7B,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,cAAc,IAAA,iMAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;IACjD,aAAa;IACb,OAAO,eAAe;AACxB"}},
    {"offset": {"line": 121, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/krish/Downloads/nivarasilverjewels/lib/email.ts"],"sourcesContent":["import nodemailer from 'nodemailer';\r\n\r\ninterface EmailOptions {\r\n  to: string | string[];\r\n  subject: string;\r\n  html: string;\r\n  text?: string;\r\n}\r\n\r\n// Create a transporter using SMTP\r\nconst createTransporter = () => {\r\n  try {\r\n    // For Gmail SMTP\r\n    if (process.env.EMAIL_PROVIDER === 'gmail' && process.env.GMAIL_USER && process.env.GMAIL_APP_PASSWORD) {\r\n      console.log('[v0] Using Gmail SMTP configuration');\r\n      return nodemailer.createTransport({\r\n        host: 'smtp.gmail.com',\r\n        port: 587,\r\n        secure: false, // true for 465, false for other ports\r\n        auth: {\r\n          user: process.env.GMAIL_USER,\r\n          pass: process.env.GMAIL_APP_PASSWORD,\r\n        },\r\n        tls: {\r\n          rejectUnauthorized: false\r\n        }\r\n      });\r\n    }\r\n    \r\n    // For Outlook/Hotmail SMTP\r\n    if (process.env.EMAIL_PROVIDER === 'outlook' && process.env.OUTLOOK_USER && process.env.OUTLOOK_PASSWORD) {\r\n      console.log('[v0] Using Outlook SMTP configuration');\r\n      return nodemailer.createTransport({\r\n        host: 'smtp-mail.outlook.com',\r\n        port: 587,\r\n        secure: false,\r\n        auth: {\r\n          user: process.env.OUTLOOK_USER,\r\n          pass: process.env.OUTLOOK_PASSWORD,\r\n        },\r\n      });\r\n    }\r\n    \r\n    // For custom SMTP (like SendGrid, Mailgun, etc.)\r\n    if (process.env.SMTP_HOST && process.env.SMTP_PORT && process.env.SMTP_USER && process.env.SMTP_PASSWORD) {\r\n      console.log('[v0] Using custom SMTP configuration');\r\n      return nodemailer.createTransport({\r\n        host: process.env.SMTP_HOST,\r\n        port: parseInt(process.env.SMTP_PORT),\r\n        secure: process.env.SMTP_SECURE === 'true', // true for 465, false for other ports\r\n        auth: {\r\n          user: process.env.SMTP_USER,\r\n          pass: process.env.SMTP_PASSWORD,\r\n        },\r\n      });\r\n    }\r\n    \r\n    console.log('[v0] No email provider configured');\r\n    // Fallback to console logging if no email configuration is provided\r\n    return null;\r\n  } catch (error) {\r\n    console.error('[v0] Error creating email transporter:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\n// Send email function using nodemailer\r\nexport async function sendEmail(options: EmailOptions): Promise<boolean> {\r\n  try {\r\n    const transporter = createTransporter();\r\n    \r\n    // If no transporter is configured, fallback to console logging\r\n    if (!transporter) {\r\n      console.log(\"=== EMAIL NOTIFICATION (FALLBACK MODE) ===\");\r\n      console.log(\"Subject:\", options.subject);\r\n      console.log(\"To:\", options.to);\r\n      console.log(\"=========================\");\r\n      return true;\r\n    }\r\n    \r\n    // Configure email data\r\n    const mailOptions = {\r\n      from: process.env.FROM_EMAIL || `\"NIVARA Store\" <${process.env.GMAIL_USER || 'noreply@nivara.com'}>`,\r\n      to: Array.isArray(options.to) ? options.to.join(', ') : options.to,\r\n      subject: options.subject,\r\n      html: options.html,\r\n      text: options.text,\r\n    };\r\n    \r\n    console.log('[v0] Attempting to send email with options:', {\r\n      from: mailOptions.from,\r\n      to: mailOptions.to,\r\n      subject: mailOptions.subject\r\n    });\r\n    \r\n    // Verify connection configuration\r\n    await transporter.verify();\r\n    console.log('[v0] Server is ready to take our messages');\r\n    \r\n    // Send email\r\n    const info = await transporter.sendMail(mailOptions);\r\n    console.log('[v0] Email sent successfully. Message ID:', info.messageId);\r\n    return true;\r\n  } catch (error: any) {\r\n    console.error(\"[v0] Email sending error occurred:\", error.message);\r\n    console.error(\"[v0] Error details:\", error);\r\n    // Log environment variables (without sensitive data)\r\n    console.log('[v0] Email config:', {\r\n      EMAIL_PROVIDER: process.env.EMAIL_PROVIDER,\r\n      GMAIL_USER: process.env.GMAIL_USER,\r\n      FROM_EMAIL: process.env.FROM_EMAIL,\r\n      SMTP_HOST: process.env.SMTP_HOST,\r\n      SMTP_PORT: process.env.SMTP_PORT\r\n    });\r\n    return false;\r\n  }\r\n}\r\n\r\n// Generate HTML email template for order notifications\r\nexport function generateOrderNotificationEmail(order: any, customer: any, items: any[], shippingAddress: any): string {\r\n  const itemsHtml = items.map(item => `\r\n    <tr>\r\n      <td style=\"padding: 8px; border: 1px solid #ddd;\">\r\n        ${item.product_name}\r\n        ${item.quantity > 1 ? `<br/><small>Quantity: ${item.quantity}</small>` : ''}\r\n      </td>\r\n      <td style=\"padding: 8px; border: 1px solid #ddd; text-align: right;\">₹${(Number(item.product_price) * item.quantity).toFixed(2)}</td>\r\n    </tr>\r\n  `).join('');\r\n\r\n  return `\r\n    <!DOCTYPE html>\r\n    <html>\r\n    <head>\r\n      <meta charset=\"utf-8\">\r\n      <title>New Order Notification</title>\r\n    </head>\r\n    <body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333;\">\r\n      <div style=\"max-width: 600px; margin: 0 auto; padding: 20px;\">\r\n        <h1 style=\"color: #B29789;\">New Order Received</h1>\r\n        \r\n        <p><strong>Order Number:</strong> ${order.order_number}</p>\r\n        <p><strong>Order Date:</strong> ${new Date(order.created_at).toLocaleString('en-IN')}</p>\r\n        <p><strong>Payment Method:</strong> ${order.payment_type === 'razorpay' ? 'Razorpay' : 'Cash on Delivery'}</p>\r\n        \r\n        <h2 style=\"color: #B29789; border-bottom: 2px solid #B29789; padding-bottom: 5px;\">Customer Information</h2>\r\n        <p><strong>Name:</strong> ${customer.full_name || ''}</p>\r\n        <p><strong>Email:</strong> ${customer.email || ''}</p>\r\n        ${customer.phone ? `<p><strong>Phone:</strong> ${customer.phone}</p>` : ''}\r\n        \r\n        <h2 style=\"color: #B29789; border-bottom: 2px solid #B29789; padding-bottom: 5px;\">Shipping Address</h2>\r\n        <p>\r\n          ${shippingAddress?.address_line1 || ''}<br>\r\n          ${shippingAddress?.address_line2 ? `${shippingAddress.address_line2}<br>` : ''}\r\n          ${(shippingAddress?.city || '') + (shippingAddress?.state ? `, ${shippingAddress.state}` : '') + (shippingAddress?.postal_code ? ` ${shippingAddress.postal_code}` : '')}<br>\r\n          ${shippingAddress?.country || ''}\r\n        </p>\r\n        \r\n        <h2 style=\"color: #B29789; border-bottom: 2px solid #B29789; padding-bottom: 5px;\">Order Items</h2>\r\n        <table style=\"width: 100%; border-collapse: collapse; border: 1px solid #ddd;\">\r\n          <thead>\r\n            <tr style=\"background-color: #f8f8f8;\">\r\n              <th style=\"padding: 10px; border: 1px solid #ddd; text-align: left;\">Item</th>\r\n              <th style=\"padding: 10px; border: 1px solid #ddd; text-align: right;\">Total</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            ${itemsHtml}\r\n            <tr>\r\n              <td style=\"padding: 8px; border: 1px solid #ddd; font-weight: bold;\">Total Amount</td>\r\n              <td style=\"padding: 8px; border: 1px solid #ddd; text-align: right; font-weight: bold;\">₹${Number(order.total_amount).toFixed(2)}</td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n        \r\n        <p style=\"margin-top: 20px; padding-top: 10px; border-top: 1px solid #eee;\">\r\n          <a href=\"${process.env.NEXT_PUBLIC_SITE_URL || 'https://your-site.com'}/admin/orders/${order.id}\" \r\n             style=\"display: inline-block; padding: 10px 20px; background-color: #B29789; color: white; text-decoration: none; border-radius: 4px;\">\r\n            View Order Details\r\n          </a>\r\n        </p>\r\n      </div>\r\n    </body>\r\n    </html>\r\n  `;\r\n}\r\n\r\n// Generate HTML email template for customer order confirmation\r\nexport function generateCustomerOrderConfirmationEmail(order: any, customer: any, items: any[], shippingAddress: any): string {\r\n  const itemsHtml = items.map(item => `\r\n    <tr>\r\n      <td style=\"padding: 8px; border: 1px solid #ddd;\">\r\n        ${item.product_name}\r\n        ${item.quantity > 1 ? `<br/><small>Quantity: ${item.quantity}</small>` : ''}\r\n      </td>\r\n      <td style=\"padding: 8px; border: 1px solid #ddd; text-align: right;\">₹${(Number(item.product_price) * item.quantity).toFixed(2)}</td>\r\n    </tr>\r\n  `).join('');\r\n\r\n  return `\r\n    <!DOCTYPE html>\r\n    <html>\r\n    <head>\r\n      <meta charset=\"utf-8\">\r\n      <title>Order Confirmation</title>\r\n    </head>\r\n    <body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333;\">\r\n      <div style=\"max-width: 600px; margin: 0 auto; padding: 20px;\">\r\n        <h1 style=\"color: #B29789;\">Order Confirmation</h1>\r\n        \r\n        <p>Dear ${customer.full_name || 'Customer'},</p>\r\n        \r\n        <p>Thank you for your order! We've received your order and are processing it.</p>\r\n        \r\n        <p><strong>Order Number:</strong> ${order.order_number}</p>\r\n        <p><strong>Order Date:</strong> ${new Date(order.created_at).toLocaleString('en-IN')}</p>\r\n        <p><strong>Payment Method:</strong> ${order.payment_type === 'razorpay' ? 'Razorpay' : 'Cash on Delivery'}</p>\r\n        \r\n        <h2 style=\"color: #B29789; border-bottom: 2px solid #B29789; padding-bottom: 5px;\">Shipping Address</h2>\r\n        <p>\r\n          ${shippingAddress?.address_line1 || ''}<br>\r\n          ${shippingAddress?.address_line2 ? `${shippingAddress.address_line2}<br>` : ''}\r\n          ${(shippingAddress?.city || '') + (shippingAddress?.state ? `, ${shippingAddress.state}` : '') + (shippingAddress?.postal_code ? ` ${shippingAddress.postal_code}` : '')}<br>\r\n          ${shippingAddress?.country || ''}\r\n        </p>\r\n        \r\n        <h2 style=\"color: #B29789; border-bottom: 2px solid #B29789; padding-bottom: 5px;\">Order Items</h2>\r\n        <table style=\"width: 100%; border-collapse: collapse; border: 1px solid #ddd;\">\r\n          <thead>\r\n            <tr style=\"background-color: #f8f8f8;\">\r\n              <th style=\"padding: 10px; border: 1px solid #ddd; text-align: left;\">Item</th>\r\n              <th style=\"padding: 10px; border: 1px solid #ddd; text-align: right;\">Total</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            ${itemsHtml}\r\n            <tr>\r\n              <td style=\"padding: 8px; border: 1px solid #ddd; font-weight: bold;\">Total Amount</td>\r\n              <td style=\"padding: 8px; border: 1px solid #ddd; text-align: right; font-weight: bold;\">₹${Number(order.total_amount).toFixed(2)}</td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n        \r\n        <p style=\"margin-top: 20px;\">\r\n          We'll notify you when your order has been shipped. If you have any questions, please contact us.\r\n        </p>\r\n        \r\n        <p>Thank you for shopping with NIVARA!</p>\r\n        \r\n        <p style=\"margin-top: 30px; padding-top: 10px; border-top: 1px solid #eee;\">\r\n          <a href=\"${process.env.NEXT_PUBLIC_SITE_URL || 'https://your-site.com'}/orders/${order.id}\" \r\n             style=\"display: inline-block; padding: 10px 20px; background-color: #B29789; color: white; text-decoration: none; border-radius: 4px;\">\r\n            View Order Details\r\n          </a>\r\n        </p>\r\n      </div>\r\n    </body>\r\n    </html>\r\n  `;\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 370, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/krish/Downloads/nivarasilverjewels/app/actions/orders.ts"],"sourcesContent":["\"use server\"\n\nimport { sql } from \"@/lib/db\"\nimport { getSession } from \"@/lib/session\"\nimport { revalidatePath } from \"next/cache\"\nimport { sendEmail, generateOrderNotificationEmail } from \"@/lib/email\"\n\ninterface OrderItem {\n  productId: number\n  quantity: number\n  price: number\n}\n\ninterface OrderData {\n  items: OrderItem[]\n  shippingAddress: any\n  shippingAddressId: number | null\n  paymentMethod: string\n  totalAmount: number\n}\n\nexport async function createOrder(data: OrderData) {\n  try {\n    const session = await getSession()\n\n    if (!session) {\n      return { error: \"Please sign in to place an order\" }\n    }\n\n    // Generate order number\n    const orderNumber = `NIVARA-${Date.now()}`\n\n    const order: any = await sql`\n      INSERT INTO orders (\n        user_id, \n        order_number, \n        total_amount, \n        status, \n        payment_status,\n        payment_type,\n        shipping_address,\n        shipping_address_id\n      )\n      VALUES (\n        ${session.userId},\n        ${orderNumber},\n        ${data.totalAmount},\n        'pending',\n        ${data.paymentMethod === \"cod\" ? \"pending\" : \"awaiting_payment\"},\n        ${data.paymentMethod},\n        ${data.shippingAddressId ? null : JSON.stringify(data.shippingAddress)},\n        ${data.shippingAddressId || null}\n      )\n      RETURNING id\n    `\n\n    const orderId = order[0].id\n\n    // Insert order items\n    for (const item of data.items) {\n      const product: any = await sql`\n        SELECT name, price FROM products WHERE id = ${item.productId}\n      `\n\n      await sql`\n        INSERT INTO order_items (order_id, product_id, product_name, product_price, quantity)\n        VALUES (${orderId}, ${item.productId}, ${product[0].name}, ${item.price}, ${item.quantity})\n      `\n    }\n\n    // Clear cart\n    await sql`\n      DELETE FROM cart_items WHERE user_id = ${session.userId}\n    `\n\n    revalidatePath(\"/cart\")\n    revalidatePath(\"/orders\")\n    // Revalidate the cart count API endpoint to update the cart counter\n    revalidatePath(\"/api/cart/count\")\n\n    // Save the checkout address as default if it's a new address\n    try {\n      // Only save if it's a new address (not from existing saved addresses)\n      if (!data.shippingAddressId && data.shippingAddress) {\n        // Check if this address already exists for this user\n        const existingAddresses: any = await sql`\n          SELECT id FROM addresses \n          WHERE user_id = ${session.userId}\n          AND address_line1 = ${data.shippingAddress.address_line1}\n          AND city = ${data.shippingAddress.city}\n          AND state = ${data.shippingAddress.state}\n          AND postal_code = ${data.shippingAddress.postal_code}\n        `\n\n        if (existingAddresses.length === 0) {\n          // Mark all existing addresses as non-default\n          await sql`\n            UPDATE addresses \n            SET is_default = false \n            WHERE user_id = ${session.userId}\n          `\n\n          // Save the new address as default\n          await sql`\n            INSERT INTO addresses (\n              user_id, \n              address_line1, \n              address_line2, \n              city, \n              state, \n              postal_code, \n              country, \n              is_default\n            )\n            VALUES (\n              ${session.userId},\n              ${data.shippingAddress.address_line1},\n              ${data.shippingAddress.address_line2 || ''},\n              ${data.shippingAddress.city},\n              ${data.shippingAddress.state},\n              ${data.shippingAddress.postal_code},\n              ${data.shippingAddress.country || 'India'},\n              true\n            )\n          `\n        } else {\n          // If address exists, make it the default\n          const addressId = existingAddresses[0].id\n          await sql`\n            UPDATE addresses \n            SET is_default = false \n            WHERE user_id = ${session.userId}\n          `\n          await sql`\n            UPDATE addresses \n            SET is_default = true \n            WHERE id = ${addressId}\n          `\n        }\n      } else if (data.shippingAddressId) {\n        // If using an existing address, make it the default\n        await sql`\n          UPDATE addresses \n          SET is_default = false \n          WHERE user_id = ${session.userId}\n        `\n        await sql`\n          UPDATE addresses \n          SET is_default = true \n          WHERE id = ${data.shippingAddressId}\n        `\n      }\n    } catch (addressError) {\n      console.error(\"[v0] Failed to save default address:\", addressError)\n      // Don't fail the order creation if address saving fails\n    }\n\n    // Send email notifications to admin emails and customer\n    try {\n      // Get active admin emails\n      const adminEmailsResult: any = await sql`\n        SELECT email FROM admin_emails WHERE is_active = true\n      `\n      \n      const adminEmails = adminEmailsResult.map((row: any) => row.email)\n      \n      // Get order details for email\n      const orderDetails: any = await sql`\n        SELECT o.*, u.full_name, u.email as customer_email, u.phone as customer_phone\n        FROM orders o\n        JOIN users u ON o.user_id = u.id\n        WHERE o.id = ${orderId}\n      `\n      \n      const orderItems: any = await sql`\n        SELECT * FROM order_items WHERE order_id = ${orderId}\n      `\n      \n      if (orderDetails.length > 0) {\n        const order = orderDetails[0]\n        const customer = {\n          full_name: order.full_name,\n          email: order.customer_email,\n          phone: order.customer_phone\n        }\n        \n        // Get shipping address\n        let shippingAddress = null\n        if (order.shipping_address_id) {\n          const addressResult: any = await sql`\n            SELECT * FROM addresses WHERE id = ${order.shipping_address_id}\n          `\n          if (addressResult.length > 0) {\n            shippingAddress = addressResult[0]\n          }\n        } else if (order.shipping_address) {\n          try {\n            shippingAddress = JSON.parse(order.shipping_address)\n          } catch (e) {\n            shippingAddress = {}\n          }\n        }\n        \n        if (shippingAddress) {\n          const emailHtml = generateOrderNotificationEmail(order, customer, orderItems, shippingAddress)\n          \n          // Send email to admins\n          if (adminEmails.length > 0) {\n            await sendEmail({\n              to: adminEmails,\n              subject: `New Order #${order.order_number} Received`,\n              html: emailHtml\n            })\n          }\n          \n          // Send confirmation email to customer\n          await sendEmail({\n            to: customer.email,\n            subject: `Order Confirmation #${order.order_number}`,\n            html: generateCustomerOrderConfirmationEmail(order, customer, orderItems, shippingAddress)\n          })\n        }\n      }\n    } catch (emailError) {\n      console.error(\"[v0] Failed to send order notification email:\", emailError)\n      // Don't fail the order creation if email sending fails\n      // But log this as a critical issue that needs attention\n      console.error(\"[v0] CRITICAL: Email notification failed - this needs immediate attention!\")\n    }\n\n    return { success: true, orderId, orderNumber }\n  } catch (error) {\n    console.error(\"[v0] Create order error:\", error)\n    return { error: \"Failed to create order\" }\n  }\n}\n\nexport async function cancelOrder(orderId: number) {\n  try {\n    const session = await getSession()\n\n    if (!session) {\n      return { error: \"Please sign in to cancel order\" }\n    }\n\n    // Check if order belongs to user\n    const order: any = await sql`\n      SELECT * FROM orders WHERE id = ${orderId} AND user_id = ${session.userId}\n    `\n\n    if (order.length === 0) {\n      return { error: \"Order not found\" }\n    }\n\n    // Only allow cancellation for pending or processing orders\n    if (![\"pending\", \"processing\"].includes(order[0].status)) {\n      return { error: \"Cannot cancel order in current status\" }\n    }\n\n    // Update order status\n    await sql`\n      UPDATE orders\n      SET status = 'cancelled'\n      WHERE id = ${orderId}\n    `\n\n    revalidatePath(\"/account\")\n    revalidatePath(\"/orders\")\n    revalidatePath(`/orders/${orderId}`)\n\n    return { success: true }\n  } catch (error) {\n    console.error(\"[v0] Cancel order error:\", error)\n    return { error: \"Failed to cancel order\" }\n  }\n}\n\n// Generate HTML email template for customer order confirmation\nfunction generateCustomerOrderConfirmationEmail(order: any, customer: any, items: any[], shippingAddress: any): string {\n  const itemsHtml = items.map(item => `\n    <tr>\n      <td style=\"padding: 8px; border: 1px solid #ddd;\">\n        ${item.product_name}\n        ${item.quantity > 1 ? `<br/><small>Quantity: ${item.quantity}</small>` : ''}\n      </td>\n      <td style=\"padding: 8px; border: 1px solid #ddd; text-align: right;\">₹${(Number(item.product_price) * item.quantity).toFixed(2)}</td>\n    </tr>\n  `).join('');\n\n  return `\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset=\"utf-8\">\n      <title>Order Confirmation</title>\n    </head>\n    <body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333;\">\n      <div style=\"max-width: 600px; margin: 0 auto; padding: 20px;\">\n        <h1 style=\"color: #B29789;\">Order Confirmation</h1>\n        \n        <p>Dear ${customer.full_name},</p>\n        \n        <p>Thank you for your order! We've received your order and are processing it.</p>\n        \n        <p><strong>Order Number:</strong> ${order.order_number}</p>\n        <p><strong>Order Date:</strong> ${new Date(order.created_at).toLocaleString('en-IN')}</p>\n        <p><strong>Payment Method:</strong> ${order.payment_type === 'razorpay' ? 'Razorpay' : 'Cash on Delivery'}</p>\n        \n        <h2 style=\"color: #B29789; border-bottom: 2px solid #B29789; padding-bottom: 5px;\">Shipping Address</h2>\n        <p>\n          ${shippingAddress.address_line1}<br>\n          ${shippingAddress.address_line2 ? `${shippingAddress.address_line2}<br>` : ''}\n          ${shippingAddress.city}, ${shippingAddress.state} ${shippingAddress.postal_code}<br>\n          ${shippingAddress.country}\n        </p>\n        \n        <h2 style=\"color: #B29789; border-bottom: 2px solid #B29789; padding-bottom: 5px;\">Order Items</h2>\n        <table style=\"width: 100%; border-collapse: collapse; border: 1px solid #ddd;\">\n          <thead>\n            <tr style=\"background-color: #f8f8f8;\">\n              <th style=\"padding: 10px; border: 1px solid #ddd; text-align: left;\">Item</th>\n              <th style=\"padding: 10px; border: 1px solid #ddd; text-align: right;\">Total</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${itemsHtml}\n            <tr>\n              <td style=\"padding: 8px; border: 1px solid #ddd; font-weight: bold;\">Total Amount</td>\n              <td style=\"padding: 8px; border: 1px solid #ddd; text-align: right; font-weight: bold;\">₹${Number(order.total_amount).toFixed(2)}</td>\n            </tr>\n          </tbody>\n        </table>\n        \n        <p style=\"margin-top: 20px;\">\n          We'll notify you when your order has been shipped. If you have any questions, please contact us.\n        </p>\n        \n        <p>Thank you for shopping with NIVARA!</p>\n        \n        <p style=\"margin-top: 30px; padding-top: 10px; border-top: 1px solid #eee;\">\n          <a href=\"${process.env.NEXT_PUBLIC_SITE_URL || 'https://your-site.com'}/orders/${order.id}\" \n             style=\"display: inline-block; padding: 10px 20px; background-color: #B29789; color: white; text-decoration: none; border-radius: 4px;\">\n            View Order Details\n          </a>\n        </p>\n      </div>\n    </body>\n    </html>\n  `;\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 717, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/krish/Downloads/nivarasilverjewels/app/actions/admin.ts"],"sourcesContent":["\"use server\"\n\nimport { cookies } from \"next/headers\"\nimport { revalidatePath } from \"next/cache\"\nimport { verifyAuth } from \"@/lib/session\"\nimport { sql } from \"@/lib/db\"\n\nexport async function updateOrderStatus(orderId: number, status: string) {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"session\")?.value\n\n  if (!token) {\n    return { success: false, error: \"Unauthorized\" }\n  }\n\n  const user = await verifyAuth(token)\n  if (!user || user.role !== \"admin\") {\n    return { success: false, error: \"Unauthorized\" }\n  }\n\n  try {\n    await sql`\n      UPDATE orders\n      SET status = ${status}, updated_at = CURRENT_TIMESTAMP\n      WHERE id = ${orderId}\n    `\n\n    revalidatePath(\"/admin/orders\")\n    return { success: true }\n  } catch (error) {\n    return { success: false, error: \"Failed to update order\" }\n  }\n}\n\nexport async function deleteProduct(productId: number) {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"session\")?.value\n\n  if (!token) {\n    return { success: false, error: \"Unauthorized\" }\n  }\n\n  const user = await verifyAuth(token)\n  if (!user || user.role !== \"admin\") {\n    return { success: false, error: \"Unauthorized\" }\n  }\n\n  try {\n    await sql`\n      DELETE FROM products\n      WHERE id = ${productId}\n    `\n\n    revalidatePath(\"/admin/products\")\n    revalidatePath(\"/shop\")\n    return { success: true }\n  } catch (error) {\n    return { success: false, error: \"Failed to delete product\" }\n  }\n}\n\nexport async function addProduct(data: any) {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"session\")?.value\n\n  if (!token) {\n    return { success: false, error: \"Unauthorized\" }\n  }\n\n  const user = await verifyAuth(token)\n  if (!user || user.role !== \"admin\") {\n    return { success: false, error: \"Unauthorized\" }\n  }\n\n  try {\n    const slug = data.name\n      .toLowerCase()\n      .replace(/[^a-z0-9]+/g, \"-\")\n      .replace(/(^-|-$)/g, \"\")\n\n    const imagesJson = JSON.stringify(Array.isArray(data.images) ? data.images : [data.image_url])\n\n    await sql`\n      INSERT INTO products (\n        name, slug, description, price, category_id, image_url, images, metal_purity, design_number\n      )\n      VALUES (\n        ${data.name}, ${slug}, ${data.description}, ${data.price}, \n        ${data.category_id}, ${data.image_url},\n        ${imagesJson}, ${data.metal_purity || null}, ${data.design_number || null}\n      )\n    `\n\n    revalidatePath(\"/admin/products\")\n    revalidatePath(\"/shop\")\n    return { success: true }\n  } catch (error) {\n    return { success: false, error: \"Failed to add product\" }\n  }\n}\n\nexport async function updateProduct(productId: number, data: any) {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"session\")?.value\n\n  if (!token) {\n    return { success: false, error: \"Unauthorized\" }\n  }\n\n  const user = await verifyAuth(token)\n  if (!user || user.role !== \"admin\") {\n    return { success: false, error: \"Unauthorized\" }\n  }\n\n  try {\n    const imagesJson = JSON.stringify(Array.isArray(data.images) ? data.images : [data.image_url])\n\n    await sql`\n      UPDATE products\n      SET \n        name = ${data.name},\n        description = ${data.description},\n        price = ${data.price},\n        category_id = ${data.category_id},\n        image_url = ${data.image_url},\n        images = ${imagesJson},\n        metal_purity = ${data.metal_purity || null},\n        design_number = ${data.design_number || null},\n        updated_at = CURRENT_TIMESTAMP\n      WHERE id = ${productId}\n    `\n\n    revalidatePath(\"/admin/products\")\n    revalidatePath(\"/shop\")\n    revalidatePath(`/products/${productId}`)\n    return { success: true }\n  } catch (error) {\n    return { success: false, error: \"Failed to update product\" }\n  }\n}\n\nexport async function addCategory(data: {\n  name: string\n  description: string\n  image_url: string\n  seo_title?: string\n  seo_description?: string\n}) {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"session\")?.value\n\n  if (!token) {\n    return { success: false, error: \"Unauthorized\" }\n  }\n\n  const user = await verifyAuth(token)\n  if (!user || user.role !== \"admin\") {\n    return { success: false, error: \"Unauthorized\" }\n  }\n\n  try {\n    const slug = data.name\n      .toLowerCase()\n      .replace(/[^a-z0-9]+/g, \"-\")\n      .replace(/(^-|-$)/g, \"\")\n\n    const seoTitle = data.seo_title || `${data.name} | NIVARA Jewellery`\n    const seoDescription = data.seo_description || data.description\n\n    await sql`\n      INSERT INTO categories (name, slug, description, image_url, meta_title, meta_description)\n      VALUES (${data.name}, ${slug}, ${data.description}, ${data.image_url}, ${seoTitle}, ${seoDescription})\n    `\n\n    revalidatePath(\"/admin/categories\")\n    revalidatePath(\"/shop\")\n    revalidatePath(\"/categories\")\n    return { success: true }\n  } catch (error) {\n    return { success: false, error: \"Failed to add category\" }\n  }\n}\n\nexport async function updateCategory(\n  categoryId: number,\n  data: { name: string; description: string; image_url: string; seo_title?: string; seo_description?: string },\n) {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"session\")?.value\n\n  if (!token) {\n    return { success: false, error: \"Unauthorized\" }\n  }\n\n  const user = await verifyAuth(token)\n  if (!user || user.role !== \"admin\") {\n    return { success: false, error: \"Unauthorized\" }\n  }\n\n  try {\n    const slug = data.name\n      .toLowerCase()\n      .replace(/[^a-z0-9]+/g, \"-\")\n      .replace(/(^-|-$)/g, \"\")\n\n    const seoTitle = data.seo_title || `${data.name} | NIVARA Jewellery`\n    const seoDescription = data.seo_description || data.description\n\n    await sql`\n      UPDATE categories\n      SET \n        name = ${data.name},\n        slug = ${slug},\n        description = ${data.description},\n        image_url = ${data.image_url},\n        meta_title = ${seoTitle},\n        meta_description = ${seoDescription}\n      WHERE id = ${categoryId}\n    `\n\n    revalidatePath(\"/admin/categories\")\n    revalidatePath(\"/shop\")\n    revalidatePath(`/categories/${slug}`)\n    return { success: true }\n  } catch (error) {\n    return { success: false, error: \"Failed to update category\" }\n  }\n}\n\nexport async function deleteCategory(categoryId: number) {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"session\")?.value\n\n  if (!token) {\n    return { success: false, error: \"Unauthorized\" }\n  }\n\n  const user = await verifyAuth(token)\n  if (!user || user.role !== \"admin\") {\n    return { success: false, error: \"Unauthorized\" }\n  }\n\n  try {\n    await sql`\n      DELETE FROM categories\n      WHERE id = ${categoryId}\n    `\n\n    revalidatePath(\"/admin/categories\")\n    revalidatePath(\"/shop\")\n    return { success: true }\n  } catch (error) {\n    return { success: false, error: \"Failed to delete category\" }\n  }\n}\n\nexport async function cancelOrder(orderId: number) {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"session\")?.value\n\n  if (!token) {\n    return { success: false, error: \"Unauthorized\" }\n  }\n\n  const user = await verifyAuth(token)\n  if (!user || user.role !== \"admin\") {\n    return { success: false, error: \"Unauthorized\" }\n  }\n\n  try {\n    // Check if order exists\n    const order = await sql`\n      SELECT * FROM orders WHERE id = ${orderId}\n    `\n\n    if (order.length === 0) {\n      return { success: false, error: \"Order not found\" }\n    }\n\n    // Only allow cancellation for pending or processing orders\n    if (![\"pending\", \"processing\"].includes(order[0].status)) {\n      return { success: false, error: \"Cannot cancel order in current status\" }\n    }\n\n    // Update order status\n    await sql`\n      UPDATE orders\n      SET status = 'cancelled'\n      WHERE id = ${orderId}\n    `\n\n    revalidatePath(\"/admin/orders\")\n    revalidatePath(`/admin/orders/${orderId}`)\n    return { success: true }\n  } catch (error) {\n    console.error(\"[v0] Cancel order error:\", error)\n    return { success: false, error: \"Failed to cancel order\" }\n  }\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1095, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/krish/Downloads/nivarasilverjewels/.next-internal/server/app/orders/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getRazorpayPublicKey as '001ca282fe10a7283b3efd5841245801fa835b77a3'} from 'ACTIONS_MODULE0'\nexport {cancelOrder as '403e47e26e11f77761f2b9c2a98471a96164133b7c'} from 'ACTIONS_MODULE1'\nexport {cancelOrder as '408867af8e2270ca993b45b4be9e8102689d371ec9'} from 'ACTIONS_MODULE2'\n"],"names":[],"mappings":";AAAA;AACA;AACA"}}]
}