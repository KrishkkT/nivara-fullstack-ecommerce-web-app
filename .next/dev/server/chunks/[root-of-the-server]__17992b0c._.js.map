{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///V:/Github/nivara-fullstack-ecommerce-web-app/lib/session.ts"],"sourcesContent":["import { cookies } from \"next/headers\"\nimport { SignJWT, jwtVerify } from \"jose\"\n\nconst SECRET_KEY = new TextEncoder().encode(process.env.JWT_SECRET || \"your-secret-key-change-this-in-production\")\n\nexport interface SessionData {\n  userId: number\n  email: string\n  role: string\n}\n\nexport async function createSession(data: SessionData): Promise<string> {\n  return new SignJWT(data).setProtectedHeader({ alg: \"HS256\" }).setIssuedAt().setExpirationTime(\"7d\").sign(SECRET_KEY)\n}\n\nexport async function getSession(): Promise<SessionData | null> {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"session\")?.value\n\n  if (!token) {\n    return null\n  }\n\n  try {\n    const verified = await jwtVerify(token, SECRET_KEY)\n    return verified.payload as SessionData\n  } catch (err) {\n    return null\n  }\n}\n\nexport async function verifyAuth(token: string): Promise<SessionData | null> {\n  try {\n    const verified = await jwtVerify(token, SECRET_KEY)\n    return verified.payload as SessionData\n  } catch (err) {\n    return null\n  }\n}\n\nexport async function deleteSession(): Promise<void> {\n  const cookieStore = await cookies()\n  cookieStore.delete(\"session\")\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AAAA;;;AAEA,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAQ/D,eAAe,cAAc,IAAiB;IACnD,OAAO,IAAI,gKAAO,CAAC,MAAM,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAAG,WAAW,GAAG,iBAAiB,CAAC,MAAM,IAAI,CAAC;AAC3G;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,YAAY;IAE1C,IAAI,CAAC,OAAO;QACV,OAAO;IACT;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,oKAAS,EAAC,OAAO;QACxC,OAAO,SAAS,OAAO;IACzB,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,eAAe,WAAW,KAAa;IAC5C,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,oKAAS,EAAC,OAAO;QACxC,OAAO,SAAS,OAAO;IACzB,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///V:/Github/nivara-fullstack-ecommerce-web-app/proxy.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport type { NextRequest } from \"next/server\"\nimport { verifyAuth } from \"@/lib/session\"\n\nexport async function proxy(request: NextRequest) {\n  const token = request.cookies.get(\"session\")?.value\n\n  // Check if accessing admin routes\n  const isAdminRoute = request.nextUrl.pathname.startsWith(\"/admin\")\n\n  // Check if accessing protected routes\n  const isProtectedRoute =\n    request.nextUrl.pathname.startsWith(\"/account\") ||\n    request.nextUrl.pathname.startsWith(\"/checkout\") ||\n    request.nextUrl.pathname === \"/cart\" ||\n    request.nextUrl.pathname.startsWith(\"/orders\")\n\n  // If not a protected route, allow\n  if (!isAdminRoute && !isProtectedRoute) {\n    return NextResponse.next()\n  }\n\n  // For protected routes, check authentication\n  if (!token) {\n    const loginUrl = new URL(\"/login\", request.url)\n    loginUrl.searchParams.set(\"redirect\", request.nextUrl.pathname)\n    return NextResponse.redirect(loginUrl)\n  }\n\n  try {\n    const user = await verifyAuth(token)\n\n    if (!user) {\n      const loginUrl = new URL(\"/login\", request.url)\n      loginUrl.searchParams.set(\"redirect\", request.nextUrl.pathname)\n      return NextResponse.redirect(loginUrl)\n    }\n\n    // Check admin access\n    if (isAdminRoute && user.role !== \"admin\") {\n      return NextResponse.redirect(new URL(\"/\", request.url))\n    }\n\n    return NextResponse.next()\n  } catch (error) {\n    const loginUrl = new URL(\"/login\", request.url)\n    loginUrl.searchParams.set(\"redirect\", request.nextUrl.pathname)\n    return NextResponse.redirect(loginUrl)\n  }\n}\n\nexport const config = {\n  matcher: [\"/admin/:path*\", \"/account/:path*\", \"/cart\", \"/checkout\", \"/orders/:path*\"],\n}"],"names":[],"mappings":";;;;;;AAAA;AAEA;;;AAEO,eAAe,MAAM,OAAoB;IAC9C,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,YAAY;IAE9C,kCAAkC;IAClC,MAAM,eAAe,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAEzD,sCAAsC;IACtC,MAAM,mBACJ,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,eACpC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,gBACpC,QAAQ,OAAO,CAAC,QAAQ,KAAK,WAC7B,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAEtC,kCAAkC;IAClC,IAAI,CAAC,gBAAgB,CAAC,kBAAkB;QACtC,OAAO,8IAAY,CAAC,IAAI;IAC1B;IAEA,6CAA6C;IAC7C,IAAI,CAAC,OAAO;QACV,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC9C,SAAS,YAAY,CAAC,GAAG,CAAC,YAAY,QAAQ,OAAO,CAAC,QAAQ;QAC9D,OAAO,8IAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,4HAAU,EAAC;QAE9B,IAAI,CAAC,MAAM;YACT,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;YAC9C,SAAS,YAAY,CAAC,GAAG,CAAC,YAAY,QAAQ,OAAO,CAAC,QAAQ;YAC9D,OAAO,8IAAY,CAAC,QAAQ,CAAC;QAC/B;QAEA,qBAAqB;QACrB,IAAI,gBAAgB,KAAK,IAAI,KAAK,SAAS;YACzC,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QACvD;QAEA,OAAO,8IAAY,CAAC,IAAI;IAC1B,EAAE,OAAO,OAAO;QACd,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC9C,SAAS,YAAY,CAAC,GAAG,CAAC,YAAY,QAAQ,OAAO,CAAC,QAAQ;QAC9D,OAAO,8IAAY,CAAC,QAAQ,CAAC;IAC/B;AACF;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAiB;QAAmB;QAAS;QAAa;KAAiB;AACvF"}}]
}