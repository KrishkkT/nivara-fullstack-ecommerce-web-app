{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/krish/Downloads/nivarasilverjewels/lib/session.ts"],"sourcesContent":["import { cookies } from \"next/headers\"\nimport { SignJWT, jwtVerify } from \"jose\"\n\nconst SECRET_KEY = new TextEncoder().encode(process.env.JWT_SECRET || \"your-secret-key-change-this-in-production\")\n\nexport interface SessionData {\n  userId: number\n  email: string\n  role: string\n}\n\nexport async function createSession(data: SessionData): Promise<string> {\n  return new SignJWT(data).setProtectedHeader({ alg: \"HS256\" }).setIssuedAt().setExpirationTime(\"7d\").sign(SECRET_KEY)\n}\n\nexport async function getSession(): Promise<SessionData | null> {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"session\")?.value\n\n  if (!token) {\n    return null\n  }\n\n  try {\n    const verified = await jwtVerify(token, SECRET_KEY)\n    return verified.payload as SessionData\n  } catch (err) {\n    return null\n  }\n}\n\nexport async function verifyAuth(token: string): Promise<SessionData | null> {\n  try {\n    const verified = await jwtVerify(token, SECRET_KEY)\n    return verified.payload as SessionData\n  } catch (err) {\n    return null\n  }\n}\n\nexport async function deleteSession(): Promise<void> {\n  const cookieStore = await cookies()\n  cookieStore.delete(\"session\")\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AAAA;;;AAEA,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAQ/D,eAAe,cAAc,IAAiB;IACnD,OAAO,IAAI,qMAAO,CAAC,MAAM,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAAG,WAAW,GAAG,iBAAiB,CAAC,MAAM,IAAI,CAAC;AAC3G;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,+KAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,YAAY;IAE1C,IAAI,CAAC,OAAO;QACV,OAAO;IACT;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,yMAAS,EAAC,OAAO;QACxC,OAAO,SAAS,OAAO;IACzB,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,eAAe,WAAW,KAAa;IAC5C,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,yMAAS,EAAC,OAAO;QACxC,OAAO,SAAS,OAAO;IACzB,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,+KAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/krish/Downloads/nivarasilverjewels/lib/db.ts"],"sourcesContent":["import { neon } from \"@neondatabase/serverless\"\n\n// Lazy initialization - only check for DATABASE_URL when it's actually used\nexport const sql = ((...args: any[]) => {\n  if (!process.env.DATABASE_URL) {\n    throw new Error(\"DATABASE_URL environment variable is not set\")\n  }\n  \n  const sqlInstance = neon(process.env.DATABASE_URL)\n  // @ts-ignore\n  return sqlInstance(...args)\n}) as ReturnType<typeof neon>"],"names":[],"mappings":";;;;AAAA;;AAGO,MAAM,MAAO,CAAC,GAAG;IACtB,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;QAC7B,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,cAAc,IAAA,mMAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;IACjD,aAAa;IACb,OAAO,eAAe;AACxB"}},
    {"offset": {"line": 114, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/krish/Downloads/nivarasilverjewels/lib/auth.ts"],"sourcesContent":["import { sql } from \"./db\"\n\nexport interface User {\n  id: number\n  email: string\n  full_name: string\n  phone?: string\n  role: string\n  created_at: Date\n}\n\n// Use Web Crypto API instead of bcryptjs for better compatibility in edge environments\nexport async function hashPassword(password: string): Promise<string> {\n  const encoder = new TextEncoder()\n  const data = encoder.encode(password)\n  const hashBuffer = await crypto.subtle.digest(\"SHA-256\", data)\n  const hashArray = Array.from(new Uint8Array(hashBuffer))\n  const hashHex = hashArray.map((b) => b.toString(16).padStart(2, \"0\")).join(\"\")\n  return hashHex\n}\n\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  const passwordHash = await hashPassword(password)\n  return passwordHash === hash\n}\n\nexport async function createUser(email: string, password: string, fullName: string, phone?: string): Promise<User> {\n  const passwordHash = await hashPassword(password)\n\n  const result = await sql`\n    INSERT INTO users (email, password_hash, full_name, phone)\n    VALUES (${email}, ${passwordHash}, ${fullName}, ${phone})\n    RETURNING id, email, full_name, phone, role, created_at\n  `\n\n  return result[0] as User\n}\n\nexport async function getUserByEmail(email: string): Promise<(User & { password_hash: string }) | null> {\n  const result = await sql`\n    SELECT id, email, password_hash, full_name, phone, role, created_at\n    FROM users\n    WHERE email = ${email}\n  `\n\n  return (result[0] as User & { password_hash: string }) || null\n}\n\nexport async function getUserById(id: number): Promise<User | null> {\n  const result = await sql`\n    SELECT id, email, full_name, phone, role, created_at\n    FROM users\n    WHERE id = ${id}\n  `\n\n  return (result[0] as User) || null\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;AAYO,eAAe,aAAa,QAAgB;IACjD,MAAM,UAAU,IAAI;IACpB,MAAM,OAAO,QAAQ,MAAM,CAAC;IAC5B,MAAM,aAAa,MAAM,OAAO,MAAM,CAAC,MAAM,CAAC,WAAW;IACzD,MAAM,YAAY,MAAM,IAAI,CAAC,IAAI,WAAW;IAC5C,MAAM,UAAU,UAAU,GAAG,CAAC,CAAC,IAAM,EAAE,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG,MAAM,IAAI,CAAC;IAC3E,OAAO;AACT;AAEO,eAAe,eAAe,QAAgB,EAAE,IAAY;IACjE,MAAM,eAAe,MAAM,aAAa;IACxC,OAAO,iBAAiB;AAC1B;AAEO,eAAe,WAAW,KAAa,EAAE,QAAgB,EAAE,QAAgB,EAAE,KAAc;IAChG,MAAM,eAAe,MAAM,aAAa;IAExC,MAAM,SAAS,MAAM,qJAAG,CAAC;;YAEf,EAAE,MAAM,EAAE,EAAE,aAAa,EAAE,EAAE,SAAS,EAAE,EAAE,MAAM;;EAE1D,CAAC;IAED,OAAO,MAAM,CAAC,EAAE;AAClB;AAEO,eAAe,eAAe,KAAa;IAChD,MAAM,SAAS,MAAM,qJAAG,CAAC;;;kBAGT,EAAE,MAAM;EACxB,CAAC;IAED,OAAO,AAAC,MAAM,CAAC,EAAE,IAAyC;AAC5D;AAEO,eAAe,YAAY,EAAU;IAC1C,MAAM,SAAS,MAAM,qJAAG,CAAC;;;eAGZ,EAAE,GAAG;EAClB,CAAC;IAED,OAAO,AAAC,MAAM,CAAC,EAAE,IAAa;AAChC"}},
    {"offset": {"line": 169, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/krish/Downloads/nivarasilverjewels/app/api/profile/change-password/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\r\nimport { getSession } from \"@/lib/session\"\r\nimport { verifyPassword, hashPassword } from \"@/lib/auth\"\r\nimport { sql } from \"@/lib/db\"\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const session = await getSession()\r\n    \r\n    if (!session) {\r\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n    }\r\n    \r\n    const { currentPassword, newPassword } = await request.json()\r\n    \r\n    if (!currentPassword || !newPassword) {\r\n      return NextResponse.json({ error: \"Current password and new password are required\" }, { status: 400 })\r\n    }\r\n    \r\n    if (newPassword.length < 6) {\r\n      return NextResponse.json({ error: \"Password must be at least 6 characters long\" }, { status: 400 })\r\n    }\r\n    \r\n    // Get user with password hash\r\n    const userResult = await sql`\r\n      SELECT id, email, password_hash, full_name, phone, role, created_at\r\n      FROM users\r\n      WHERE id = ${session.userId}\r\n    `\r\n    \r\n    // Cast to any[] to handle the typing issue\r\n    const users = userResult as any[]\r\n    \r\n    if (users.length === 0) {\r\n      return NextResponse.json({ error: \"User not found\" }, { status: 404 })\r\n    }\r\n    \r\n    const user = users[0]\r\n    \r\n    // Verify current password\r\n    const isPasswordValid = await verifyPassword(currentPassword, user.password_hash)\r\n    \r\n    if (!isPasswordValid) {\r\n      return NextResponse.json({ error: \"Current password is incorrect\" }, { status: 400 })\r\n    }\r\n    \r\n    // Hash new password\r\n    const newPasswordHash = await hashPassword(newPassword)\r\n    \r\n    // Update password in database\r\n    await sql`\r\n      UPDATE users\r\n      SET password_hash = ${newPasswordHash}, updated_at = CURRENT_TIMESTAMP\r\n      WHERE id = ${session.userId}\r\n    `\r\n    \r\n    return NextResponse.json({ success: true })\r\n  } catch (error: any) {\r\n    console.error(\"[v0] Password change error:\", error)\r\n    return NextResponse.json({ error: \"Failed to change password\" }, { status: 500 })\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,iKAAU;QAEhC,IAAI,CAAC,SAAS;YACZ,OAAO,mLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,EAAE,eAAe,EAAE,WAAW,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE3D,IAAI,CAAC,mBAAmB,CAAC,aAAa;YACpC,OAAO,mLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiD,GAAG;gBAAE,QAAQ;YAAI;QACtG;QAEA,IAAI,YAAY,MAAM,GAAG,GAAG;YAC1B,OAAO,mLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8C,GAAG;gBAAE,QAAQ;YAAI;QACnG;QAEA,8BAA8B;QAC9B,MAAM,aAAa,MAAM,qJAAG,CAAC;;;iBAGhB,EAAE,QAAQ,MAAM,CAAC;IAC9B,CAAC;QAED,2CAA2C;QAC3C,MAAM,QAAQ;QAEd,IAAI,MAAM,MAAM,KAAK,GAAG;YACtB,OAAO,mLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,MAAM,OAAO,KAAK,CAAC,EAAE;QAErB,0BAA0B;QAC1B,MAAM,kBAAkB,MAAM,IAAA,kKAAc,EAAC,iBAAiB,KAAK,aAAa;QAEhF,IAAI,CAAC,iBAAiB;YACpB,OAAO,mLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgC,GAAG;gBAAE,QAAQ;YAAI;QACrF;QAEA,oBAAoB;QACpB,MAAM,kBAAkB,MAAM,IAAA,gKAAY,EAAC;QAE3C,8BAA8B;QAC9B,MAAM,qJAAG,CAAC;;0BAEY,EAAE,gBAAgB;iBAC3B,EAAE,QAAQ,MAAM,CAAC;IAC9B,CAAC;QAED,OAAO,mLAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,mLAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA4B,GAAG;YAAE,QAAQ;QAAI;IACjF;AACF"}}]
}