{"version":3,"sources":["../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","turbopack:///[project]/node_modules/nodemailer/package.json","turbopack:///[project]/node_modules/nodemailer/lib/well-known/services.json","../../../../app/actions/orders.ts","../../../../app/actions/payment.ts","../../../../.next-internal/server/app/checkout/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","{\"name\":\"nodemailer\",\"version\":\"7.0.11\",\"description\":\"Easy as cake e-mail sending from your Node.js applications\",\"main\":\"lib/nodemailer.js\",\"scripts\":{\"test\":\"node --test --test-concurrency=1 test/**/*.test.js test/**/*-test.js\",\"test:coverage\":\"c8 node --test --test-concurrency=1 test/**/*.test.js test/**/*-test.js\",\"format\":\"prettier --write \\\"**/*.{js,json,md}\\\"\",\"format:check\":\"prettier --check \\\"**/*.{js,json,md}\\\"\",\"lint\":\"eslint .\",\"lint:fix\":\"eslint . --fix\",\"update\":\"rm -rf node_modules/ package-lock.json && ncu -u && npm install\"},\"repository\":{\"type\":\"git\",\"url\":\"https://github.com/nodemailer/nodemailer.git\"},\"keywords\":[\"Nodemailer\"],\"author\":\"Andris Reinman\",\"license\":\"MIT-0\",\"bugs\":{\"url\":\"https://github.com/nodemailer/nodemailer/issues\"},\"homepage\":\"https://nodemailer.com/\",\"devDependencies\":{\"@aws-sdk/client-sesv2\":\"3.940.0\",\"bunyan\":\"1.8.15\",\"c8\":\"10.1.3\",\"eslint\":\"9.39.1\",\"eslint-config-prettier\":\"10.1.8\",\"globals\":\"16.5.0\",\"libbase64\":\"1.3.0\",\"libmime\":\"5.3.7\",\"libqp\":\"2.1.1\",\"nodemailer-ntlm-auth\":\"1.0.4\",\"prettier\":\"3.6.2\",\"proxy\":\"1.0.2\",\"proxy-test-server\":\"1.0.0\",\"smtp-server\":\"3.16.1\"},\"engines\":{\"node\":\">=6.0.0\"}}","{\"1und1\":{\"description\":\"1&1 Mail (German hosting provider)\",\"host\":\"smtp.1und1.de\",\"port\":465,\"secure\":true,\"authMethod\":\"LOGIN\"},\"126\":{\"description\":\"126 Mail (NetEase)\",\"host\":\"smtp.126.com\",\"port\":465,\"secure\":true},\"163\":{\"description\":\"163 Mail (NetEase)\",\"host\":\"smtp.163.com\",\"port\":465,\"secure\":true},\"Aliyun\":{\"description\":\"Alibaba Cloud Mail\",\"domains\":[\"aliyun.com\"],\"host\":\"smtp.aliyun.com\",\"port\":465,\"secure\":true},\"AliyunQiye\":{\"description\":\"Alibaba Cloud Enterprise Mail\",\"host\":\"smtp.qiye.aliyun.com\",\"port\":465,\"secure\":true},\"AOL\":{\"description\":\"AOL Mail\",\"domains\":[\"aol.com\"],\"host\":\"smtp.aol.com\",\"port\":587},\"Aruba\":{\"description\":\"Aruba PEC (Italian email provider)\",\"domains\":[\"aruba.it\",\"pec.aruba.it\"],\"aliases\":[\"Aruba PEC\"],\"host\":\"smtps.aruba.it\",\"port\":465,\"secure\":true,\"authMethod\":\"LOGIN\"},\"Bluewin\":{\"description\":\"Bluewin (Swiss email provider)\",\"host\":\"smtpauths.bluewin.ch\",\"domains\":[\"bluewin.ch\"],\"port\":465},\"BOL\":{\"description\":\"BOL Mail (Brazilian provider)\",\"domains\":[\"bol.com.br\"],\"host\":\"smtp.bol.com.br\",\"port\":587,\"requireTLS\":true},\"DebugMail\":{\"description\":\"DebugMail (email testing service)\",\"host\":\"debugmail.io\",\"port\":25},\"Disroot\":{\"description\":\"Disroot (privacy-focused provider)\",\"domains\":[\"disroot.org\"],\"host\":\"disroot.org\",\"port\":587,\"secure\":false,\"authMethod\":\"LOGIN\"},\"DynectEmail\":{\"description\":\"Dyn Email Delivery\",\"aliases\":[\"Dynect\"],\"host\":\"smtp.dynect.net\",\"port\":25},\"ElasticEmail\":{\"description\":\"Elastic Email\",\"aliases\":[\"Elastic Email\"],\"host\":\"smtp.elasticemail.com\",\"port\":465,\"secure\":true},\"Ethereal\":{\"description\":\"Ethereal Email (email testing service)\",\"aliases\":[\"ethereal.email\"],\"host\":\"smtp.ethereal.email\",\"port\":587},\"FastMail\":{\"description\":\"FastMail\",\"domains\":[\"fastmail.fm\"],\"host\":\"smtp.fastmail.com\",\"port\":465,\"secure\":true},\"Feishu Mail\":{\"description\":\"Feishu Mail (Lark)\",\"aliases\":[\"Feishu\",\"FeishuMail\"],\"domains\":[\"www.feishu.cn\"],\"host\":\"smtp.feishu.cn\",\"port\":465,\"secure\":true},\"Forward Email\":{\"description\":\"Forward Email (email forwarding service)\",\"aliases\":[\"FE\",\"ForwardEmail\"],\"domains\":[\"forwardemail.net\"],\"host\":\"smtp.forwardemail.net\",\"port\":465,\"secure\":true},\"GandiMail\":{\"description\":\"Gandi Mail\",\"aliases\":[\"Gandi\",\"Gandi Mail\"],\"host\":\"mail.gandi.net\",\"port\":587},\"Gmail\":{\"description\":\"Gmail\",\"aliases\":[\"Google Mail\"],\"domains\":[\"gmail.com\",\"googlemail.com\"],\"host\":\"smtp.gmail.com\",\"port\":465,\"secure\":true},\"GMX\":{\"description\":\"GMX Mail\",\"domains\":[\"gmx.com\",\"gmx.net\",\"gmx.de\"],\"host\":\"mail.gmx.com\",\"port\":587},\"Godaddy\":{\"description\":\"GoDaddy Email (US)\",\"host\":\"smtpout.secureserver.net\",\"port\":25},\"GodaddyAsia\":{\"description\":\"GoDaddy Email (Asia)\",\"host\":\"smtp.asia.secureserver.net\",\"port\":25},\"GodaddyEurope\":{\"description\":\"GoDaddy Email (Europe)\",\"host\":\"smtp.europe.secureserver.net\",\"port\":25},\"hot.ee\":{\"description\":\"Hot.ee (Estonian email provider)\",\"host\":\"mail.hot.ee\"},\"Hotmail\":{\"description\":\"Outlook.com / Hotmail\",\"aliases\":[\"Outlook\",\"Outlook.com\",\"Hotmail.com\"],\"domains\":[\"hotmail.com\",\"outlook.com\"],\"host\":\"smtp-mail.outlook.com\",\"port\":587},\"iCloud\":{\"description\":\"iCloud Mail\",\"aliases\":[\"Me\",\"Mac\"],\"domains\":[\"me.com\",\"mac.com\"],\"host\":\"smtp.mail.me.com\",\"port\":587},\"Infomaniak\":{\"description\":\"Infomaniak Mail (Swiss hosting provider)\",\"host\":\"mail.infomaniak.com\",\"domains\":[\"ik.me\",\"ikmail.com\",\"etik.com\"],\"port\":587},\"KolabNow\":{\"description\":\"KolabNow (secure email service)\",\"domains\":[\"kolabnow.com\"],\"aliases\":[\"Kolab\"],\"host\":\"smtp.kolabnow.com\",\"port\":465,\"secure\":true,\"authMethod\":\"LOGIN\"},\"Loopia\":{\"description\":\"Loopia (Swedish hosting provider)\",\"host\":\"mailcluster.loopia.se\",\"port\":465},\"Loops\":{\"description\":\"Loops\",\"host\":\"smtp.loops.so\",\"port\":587},\"mail.ee\":{\"description\":\"Mail.ee (Estonian email provider)\",\"host\":\"smtp.mail.ee\"},\"Mail.ru\":{\"description\":\"Mail.ru\",\"host\":\"smtp.mail.ru\",\"port\":465,\"secure\":true},\"Mailcatch.app\":{\"description\":\"Mailcatch (email testing service)\",\"host\":\"sandbox-smtp.mailcatch.app\",\"port\":2525},\"Maildev\":{\"description\":\"MailDev (local email testing)\",\"port\":1025,\"ignoreTLS\":true},\"MailerSend\":{\"description\":\"MailerSend\",\"host\":\"smtp.mailersend.net\",\"port\":587},\"Mailgun\":{\"description\":\"Mailgun\",\"host\":\"smtp.mailgun.org\",\"port\":465,\"secure\":true},\"Mailjet\":{\"description\":\"Mailjet\",\"host\":\"in.mailjet.com\",\"port\":587},\"Mailosaur\":{\"description\":\"Mailosaur (email testing service)\",\"host\":\"mailosaur.io\",\"port\":25},\"Mailtrap\":{\"description\":\"Mailtrap\",\"host\":\"live.smtp.mailtrap.io\",\"port\":587},\"Mandrill\":{\"description\":\"Mandrill (by Mailchimp)\",\"host\":\"smtp.mandrillapp.com\",\"port\":587},\"Naver\":{\"description\":\"Naver Mail (Korean email provider)\",\"host\":\"smtp.naver.com\",\"port\":587},\"OhMySMTP\":{\"description\":\"OhMySMTP (email delivery service)\",\"host\":\"smtp.ohmysmtp.com\",\"port\":587,\"secure\":false},\"One\":{\"description\":\"One.com Email\",\"host\":\"send.one.com\",\"port\":465,\"secure\":true},\"OpenMailBox\":{\"description\":\"OpenMailBox\",\"aliases\":[\"OMB\",\"openmailbox.org\"],\"host\":\"smtp.openmailbox.org\",\"port\":465,\"secure\":true},\"Outlook365\":{\"description\":\"Microsoft 365 / Office 365\",\"host\":\"smtp.office365.com\",\"port\":587,\"secure\":false},\"Postmark\":{\"description\":\"Postmark\",\"aliases\":[\"PostmarkApp\"],\"host\":\"smtp.postmarkapp.com\",\"port\":2525},\"Proton\":{\"description\":\"Proton Mail\",\"aliases\":[\"ProtonMail\",\"Proton.me\",\"Protonmail.com\",\"Protonmail.ch\"],\"domains\":[\"proton.me\",\"protonmail.com\",\"pm.me\",\"protonmail.ch\"],\"host\":\"smtp.protonmail.ch\",\"port\":587,\"requireTLS\":true},\"qiye.aliyun\":{\"description\":\"Alibaba Mail Enterprise Edition\",\"host\":\"smtp.mxhichina.com\",\"port\":\"465\",\"secure\":true},\"QQ\":{\"description\":\"QQ Mail\",\"domains\":[\"qq.com\"],\"host\":\"smtp.qq.com\",\"port\":465,\"secure\":true},\"QQex\":{\"description\":\"QQ Enterprise Mail\",\"aliases\":[\"QQ Enterprise\"],\"domains\":[\"exmail.qq.com\"],\"host\":\"smtp.exmail.qq.com\",\"port\":465,\"secure\":true},\"Resend\":{\"description\":\"Resend\",\"host\":\"smtp.resend.com\",\"port\":465,\"secure\":true},\"Runbox\":{\"description\":\"Runbox (Norwegian email provider)\",\"domains\":[\"runbox.com\"],\"host\":\"smtp.runbox.com\",\"port\":465,\"secure\":true},\"SendCloud\":{\"description\":\"SendCloud (Chinese email delivery)\",\"host\":\"smtp.sendcloud.net\",\"port\":2525},\"SendGrid\":{\"description\":\"SendGrid\",\"host\":\"smtp.sendgrid.net\",\"port\":587},\"SendinBlue\":{\"description\":\"Brevo (formerly Sendinblue)\",\"aliases\":[\"Brevo\"],\"host\":\"smtp-relay.brevo.com\",\"port\":587},\"SendPulse\":{\"description\":\"SendPulse\",\"host\":\"smtp-pulse.com\",\"port\":465,\"secure\":true},\"SES\":{\"description\":\"AWS SES US East (N. Virginia)\",\"host\":\"email-smtp.us-east-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-NORTHEAST-1\":{\"description\":\"AWS SES Asia Pacific (Tokyo)\",\"host\":\"email-smtp.ap-northeast-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-NORTHEAST-2\":{\"description\":\"AWS SES Asia Pacific (Seoul)\",\"host\":\"email-smtp.ap-northeast-2.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-NORTHEAST-3\":{\"description\":\"AWS SES Asia Pacific (Osaka)\",\"host\":\"email-smtp.ap-northeast-3.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-SOUTH-1\":{\"description\":\"AWS SES Asia Pacific (Mumbai)\",\"host\":\"email-smtp.ap-south-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-SOUTHEAST-1\":{\"description\":\"AWS SES Asia Pacific (Singapore)\",\"host\":\"email-smtp.ap-southeast-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-AP-SOUTHEAST-2\":{\"description\":\"AWS SES Asia Pacific (Sydney)\",\"host\":\"email-smtp.ap-southeast-2.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-CA-CENTRAL-1\":{\"description\":\"AWS SES Canada (Central)\",\"host\":\"email-smtp.ca-central-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-EU-CENTRAL-1\":{\"description\":\"AWS SES Europe (Frankfurt)\",\"host\":\"email-smtp.eu-central-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-EU-NORTH-1\":{\"description\":\"AWS SES Europe (Stockholm)\",\"host\":\"email-smtp.eu-north-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-EU-WEST-1\":{\"description\":\"AWS SES Europe (Ireland)\",\"host\":\"email-smtp.eu-west-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-EU-WEST-2\":{\"description\":\"AWS SES Europe (London)\",\"host\":\"email-smtp.eu-west-2.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-EU-WEST-3\":{\"description\":\"AWS SES Europe (Paris)\",\"host\":\"email-smtp.eu-west-3.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-SA-EAST-1\":{\"description\":\"AWS SES South America (SÃ£o Paulo)\",\"host\":\"email-smtp.sa-east-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-EAST-1\":{\"description\":\"AWS SES US East (N. Virginia)\",\"host\":\"email-smtp.us-east-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-EAST-2\":{\"description\":\"AWS SES US East (Ohio)\",\"host\":\"email-smtp.us-east-2.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-GOV-EAST-1\":{\"description\":\"AWS SES GovCloud (US-East)\",\"host\":\"email-smtp.us-gov-east-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-GOV-WEST-1\":{\"description\":\"AWS SES GovCloud (US-West)\",\"host\":\"email-smtp.us-gov-west-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-WEST-1\":{\"description\":\"AWS SES US West (N. California)\",\"host\":\"email-smtp.us-west-1.amazonaws.com\",\"port\":465,\"secure\":true},\"SES-US-WEST-2\":{\"description\":\"AWS SES US West (Oregon)\",\"host\":\"email-smtp.us-west-2.amazonaws.com\",\"port\":465,\"secure\":true},\"Seznam\":{\"description\":\"Seznam Email (Czech email provider)\",\"aliases\":[\"Seznam Email\"],\"domains\":[\"seznam.cz\",\"email.cz\",\"post.cz\",\"spoluzaci.cz\"],\"host\":\"smtp.seznam.cz\",\"port\":465,\"secure\":true},\"SMTP2GO\":{\"description\":\"SMTP2GO\",\"host\":\"mail.smtp2go.com\",\"port\":2525},\"Sparkpost\":{\"description\":\"SparkPost\",\"aliases\":[\"SparkPost\",\"SparkPost Mail\"],\"domains\":[\"sparkpost.com\"],\"host\":\"smtp.sparkpostmail.com\",\"port\":587,\"secure\":false},\"Tipimail\":{\"description\":\"Tipimail (email delivery service)\",\"host\":\"smtp.tipimail.com\",\"port\":587},\"Tutanota\":{\"description\":\"Tutanota (Tuta Mail)\",\"domains\":[\"tutanota.com\",\"tuta.com\",\"tutanota.de\",\"tuta.io\"],\"host\":\"smtp.tutanota.com\",\"port\":465,\"secure\":true},\"Yahoo\":{\"description\":\"Yahoo Mail\",\"domains\":[\"yahoo.com\"],\"host\":\"smtp.mail.yahoo.com\",\"port\":465,\"secure\":true},\"Yandex\":{\"description\":\"Yandex Mail\",\"domains\":[\"yandex.ru\"],\"host\":\"smtp.yandex.ru\",\"port\":465,\"secure\":true},\"Zimbra\":{\"description\":\"Zimbra Mail Server\",\"aliases\":[\"Zimbra Collaboration\"],\"host\":\"smtp.zimbra.com\",\"port\":587,\"requireTLS\":true},\"Zoho\":{\"description\":\"Zoho Mail\",\"host\":\"smtp.zoho.com\",\"port\":465,\"secure\":true,\"authMethod\":\"LOGIN\"}}","\"use server\"\n\nimport { sql } from \"@/lib/db\"\nimport { getSession } from \"@/lib/session\"\nimport { revalidatePath } from \"next/cache\"\nimport { sendEmail, generateOrderCancellationEmail } from \"@/lib/email\"\n\ninterface OrderItem {\n  productId: number\n  quantity: number\n  price: number\n}\n\ninterface OrderData {\n  items: OrderItem[]\n  shippingAddress: any\n  shippingAddressId: number | null\n  paymentMethod: string\n  totalAmount: number\n}\n\nexport async function createOrder(data: OrderData) {\n  try {\n    const session = await getSession()\n\n    if (!session) {\n      return { error: \"Please sign in to place an order\" }\n    }\n\n    // Generate order number\n    const orderNumber = `NIVARA-${Date.now()}`\n\n    const order: any = await sql`\n      INSERT INTO orders (\n        user_id, \n        order_number, \n        total_amount, \n        status, \n        payment_status,\n        payment_type,\n        shipping_address,\n        shipping_address_id\n      )\n      VALUES (\n        ${session.userId},\n        ${orderNumber},\n        ${data.totalAmount},\n        'pending',\n        'awaiting_payment',\n        ${data.paymentMethod},\n        ${data.shippingAddressId ? null : JSON.stringify(data.shippingAddress)},\n        ${data.shippingAddressId || null}\n      )\n      RETURNING id\n    `\n\n    const orderId = order[0].id\n\n    // Insert order items\n    for (const item of data.items) {\n      const product: any = await sql`\n        SELECT name, price FROM products WHERE id = ${item.productId}\n      `\n\n      await sql`\n        INSERT INTO order_items (order_id, product_id, product_name, product_price, quantity)\n        VALUES (${orderId}, ${item.productId}, ${product[0].name}, ${item.price}, ${item.quantity})\n      `\n    }\n\n    // Clear cart\n    await sql`\n      DELETE FROM cart_items WHERE user_id = ${session.userId}\n    `\n\n    revalidatePath(\"/cart\")\n    revalidatePath(\"/orders\")\n    // Revalidate the cart count API endpoint to update the cart counter\n    revalidatePath(\"/api/cart/count\")\n\n    // Save the checkout address as default if it's a new address\n    try {\n      // Only save if it's a new address (not from existing saved addresses)\n      if (!data.shippingAddressId && data.shippingAddress) {\n        // Check if this address already exists for this user\n        const existingAddresses: any = await sql`\n          SELECT id FROM addresses \n          WHERE user_id = ${session.userId}\n          AND address_line1 = ${data.shippingAddress.address_line1}\n          AND city = ${data.shippingAddress.city}\n          AND state = ${data.shippingAddress.state}\n          AND postal_code = ${data.shippingAddress.postal_code}\n        `\n\n        if (existingAddresses.length === 0) {\n          // Mark all existing addresses as non-default\n          await sql`\n            UPDATE addresses \n            SET is_default = false \n            WHERE user_id = ${session.userId}\n          `\n\n          // Save the new address as default\n          await sql`\n            INSERT INTO addresses (\n              user_id, \n              address_line1, \n              address_line2, \n              city, \n              state, \n              postal_code, \n              country, \n              is_default\n            )\n            VALUES (\n              ${session.userId},\n              ${data.shippingAddress.address_line1},\n              ${data.shippingAddress.address_line2 || ''},\n              ${data.shippingAddress.city},\n              ${data.shippingAddress.state},\n              ${data.shippingAddress.postal_code},\n              ${data.shippingAddress.country || 'India'},\n              true\n            )\n          `\n        } else {\n          // If address exists, make it the default\n          const addressId = existingAddresses[0].id\n          await sql`\n            UPDATE addresses \n            SET is_default = false \n            WHERE user_id = ${session.userId}\n          `\n          await sql`\n            UPDATE addresses \n            SET is_default = true \n            WHERE id = ${addressId}\n          `\n        }\n      } else if (data.shippingAddressId) {\n        // If using an existing address, make it the default\n        await sql`\n          UPDATE addresses \n          SET is_default = false \n          WHERE user_id = ${session.userId}\n        `\n        await sql`\n          UPDATE addresses \n          SET is_default = true \n          WHERE id = ${data.shippingAddressId}\n        `\n      }\n    } catch (addressError) {\n      console.error(\"[v0] Failed to save default address:\", addressError)\n      // Don't fail the order creation if address saving fails\n    }\n\n    // Email notifications will be sent after successful payment verification\n\n    return { success: true, orderId, orderNumber }\n  } catch (error) {\n    return { error: \"Failed to create order\" }\n  }\n}\n\nexport async function cancelOrder(orderId: number) {\n  try {\n    console.log(`[v0] User attempting to cancel order ${orderId}`);\n    \n    const session = await getSession()\n\n    if (!session) {\n      return { error: \"Please sign in to cancel order\" }\n    }\n\n    // Check if order belongs to user\n    const order: any = await sql`\n      SELECT * FROM orders WHERE id = ${orderId} AND user_id = ${session.userId}\n    `\n\n    if (order.length === 0) {\n      return { error: \"Order not found\" }\n    }\n\n    // Only allow cancellation for pending or processing orders\n    if (![\"pending\", \"processing\"].includes(order[0].status)) {\n      return { error: \"Cannot cancel order in current status\" }\n    }\n\n    // Get order details for email\n    const orderDetails: any = await sql`\n      SELECT o.*, u.full_name, u.email as customer_email, u.phone as customer_phone\n      FROM orders o\n      JOIN users u ON o.user_id = u.id\n      WHERE o.id = ${orderId} AND o.user_id = ${session.userId}\n    `\n\n    const orderItems: any = await sql`\n      SELECT * FROM order_items WHERE order_id = ${orderId}\n    `\n\n    // Update order status\n    await sql`\n      UPDATE orders\n      SET status = 'cancelled'\n      WHERE id = ${orderId}\n    `\n    \n    console.log(`[v0] Order ${orderId} cancelled successfully by user`);\n\n    // Send cancellation email to customer\n    if (orderDetails.length > 0) {\n      const order = orderDetails[0]\n      const customer = {\n        full_name: order.full_name,\n        email: order.customer_email,\n        phone: order.customer_phone\n      }\n\n      // Get shipping address\n      let shippingAddress = null\n      if (order.shipping_address_id) {\n        const addressResult: any = await sql`\n          SELECT * FROM addresses WHERE id = ${order.shipping_address_id}\n        `\n        if (addressResult.length > 0) {\n          shippingAddress = addressResult[0]\n        }\n      } else if (order.shipping_address) {\n        try {\n          shippingAddress = JSON.parse(order.shipping_address)\n        } catch (e) {\n          shippingAddress = {}\n        }\n      }\n\n      if (shippingAddress) {\n        try {\n          console.log(`[v0] Sending cancellation email to ${customer.email}`);\n          const emailHtml = generateOrderCancellationEmail(order, customer, orderItems, shippingAddress)\n          await sendEmail({\n            to: customer.email,\n            subject: `Order #${order.order_number} Cancelled`,\n            html: emailHtml\n          })\n          console.log(`[v0] Cancellation email sent successfully to ${customer.email}`);\n        } catch (emailError) {\n          console.error(\"[v0] Failed to send cancellation email:\", emailError)\n        }\n      } else {\n        console.warn(\"[v0] No shipping address found for order, skipping cancellation email\");\n      }\n    }\n\n    revalidatePath(\"/account\")\n    revalidatePath(\"/orders\")\n    revalidatePath(`/orders/${orderId}`)\n\n    return { success: true }\n  } catch (error) {\n    console.error(\"[v0] Failed to cancel order:\", error);\n    return { error: \"Failed to cancel order\" }\n  }\n}","\"use server\"\n\nexport async function getRazorpayPublicKey() {\n  // This server action safely returns the public Razorpay key\n  // NEXT_PUBLIC_ keys are safe to expose, but using server action is more secure\n  console.log(\"[v0] Getting Razorpay public key\")\n  const key = process.env.NEXT_PUBLIC_RAZORPAY_KEY_ID || \"\"\n  console.log(\"[v0] Razorpay public key:\", key)\n  return key\n}","export {createOrder as '4092236c67afa3346a320374b8c3df1fa7187b9005'} from 'ACTIONS_MODULE0'\nexport {getRazorpayPublicKey as '00418ce438cb53ce0d5731b9ed91863489d3d34d38'} from 'ACTIONS_MODULE1'\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0,1]}