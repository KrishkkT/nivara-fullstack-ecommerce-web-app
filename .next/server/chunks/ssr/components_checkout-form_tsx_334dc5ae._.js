module.exports=[63640,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(40695),f=a.i(5522),g=a.i(17171),h=a.i(7554),i=a.i(70121),j=a.i(50104),k=a.i(30553),l=a.i(37738),m=a.i(92843),n=a.i(46872),o=a.i(25152),p=a.i(7827),q="rovingFocusGroup.onEntryFocus",r={bubbles:!1,cancelable:!0},s="RovingFocusGroup",[t,u,v]=(0,l.createCollection)(s),[w,x]=(0,j.createContextScope)(s,[v]),[y,z]=w(s),A=c.forwardRef((a,c)=>(0,b.jsx)(t.Provider,{scope:a.__scopeRovingFocusGroup,children:(0,b.jsx)(t.Slot,{scope:a.__scopeRovingFocusGroup,children:(0,b.jsx)(B,{...a,ref:c})})}));A.displayName=s;var B=c.forwardRef((a,d)=>{let{__scopeRovingFocusGroup:e,orientation:f,loop:g=!1,dir:j,currentTabStopId:l,defaultCurrentTabStopId:m,onCurrentTabStopIdChange:t,onEntryFocus:v,preventScrollOnEntryFocus:w=!1,...x}=a,z=c.useRef(null),A=(0,i.useComposedRefs)(d,z),B=(0,p.useDirection)(j),[C,D]=(0,o.useControllableState)({prop:l,defaultProp:m??null,onChange:t,caller:s}),[E,G]=c.useState(!1),H=(0,n.useCallbackRef)(v),I=u(e),J=c.useRef(!1),[K,L]=c.useState(0);return c.useEffect(()=>{let a=z.current;if(a)return a.addEventListener(q,H),()=>a.removeEventListener(q,H)},[H]),(0,b.jsx)(y,{scope:e,orientation:f,dir:B,loop:g,currentTabStopId:C,onItemFocus:c.useCallback(a=>D(a),[D]),onItemShiftTab:c.useCallback(()=>G(!0),[]),onFocusableItemAdd:c.useCallback(()=>L(a=>a+1),[]),onFocusableItemRemove:c.useCallback(()=>L(a=>a-1),[]),children:(0,b.jsx)(k.Primitive.div,{tabIndex:E||0===K?-1:0,"data-orientation":f,...x,ref:A,style:{outline:"none",...a.style},onMouseDown:(0,h.composeEventHandlers)(a.onMouseDown,()=>{J.current=!0}),onFocus:(0,h.composeEventHandlers)(a.onFocus,a=>{let b=!J.current;if(a.target===a.currentTarget&&b&&!E){let b=new CustomEvent(q,r);if(a.currentTarget.dispatchEvent(b),!b.defaultPrevented){let a=I().filter(a=>a.focusable);F([a.find(a=>a.active),a.find(a=>a.id===C),...a].filter(Boolean).map(a=>a.ref.current),w)}}J.current=!1}),onBlur:(0,h.composeEventHandlers)(a.onBlur,()=>G(!1))})})}),C="RovingFocusGroupItem",D=c.forwardRef((a,d)=>{let{__scopeRovingFocusGroup:e,focusable:f=!0,active:g=!1,tabStopId:i,children:j,...l}=a,n=(0,m.useId)(),o=i||n,p=z(C,e),q=p.currentTabStopId===o,r=u(e),{onFocusableItemAdd:s,onFocusableItemRemove:v,currentTabStopId:w}=p;return c.useEffect(()=>{if(f)return s(),()=>v()},[f,s,v]),(0,b.jsx)(t.ItemSlot,{scope:e,id:o,focusable:f,active:g,children:(0,b.jsx)(k.Primitive.span,{tabIndex:q?0:-1,"data-orientation":p.orientation,...l,ref:d,onMouseDown:(0,h.composeEventHandlers)(a.onMouseDown,a=>{f?p.onItemFocus(o):a.preventDefault()}),onFocus:(0,h.composeEventHandlers)(a.onFocus,()=>p.onItemFocus(o)),onKeyDown:(0,h.composeEventHandlers)(a.onKeyDown,a=>{if("Tab"===a.key&&a.shiftKey)return void p.onItemShiftTab();if(a.target!==a.currentTarget)return;let b=function(a,b,c){var d;let e=(d=a.key,"rtl"!==c?d:"ArrowLeft"===d?"ArrowRight":"ArrowRight"===d?"ArrowLeft":d);if(!("vertical"===b&&["ArrowLeft","ArrowRight"].includes(e))&&!("horizontal"===b&&["ArrowUp","ArrowDown"].includes(e)))return E[e]}(a,p.orientation,p.dir);if(void 0!==b){if(a.metaKey||a.ctrlKey||a.altKey||a.shiftKey)return;a.preventDefault();let e=r().filter(a=>a.focusable).map(a=>a.ref.current);if("last"===b)e.reverse();else if("prev"===b||"next"===b){var c,d;"prev"===b&&e.reverse();let f=e.indexOf(a.currentTarget);e=p.loop?(c=e,d=f+1,c.map((a,b)=>c[(d+b)%c.length])):e.slice(f+1)}setTimeout(()=>F(e))}}),children:"function"==typeof j?j({isCurrentTabStop:q,hasTabStop:null!=w}):j})})});D.displayName=C;var E={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function F(a,b=!1){let c=document.activeElement;for(let d of a)if(d===c||(d.focus({preventScroll:b}),document.activeElement!==c))return}var G=a.i(3688),H=a.i(77994),I=a.i(77192),J="Radio",[K,L]=(0,j.createContextScope)(J),[M,N]=K(J),O=c.forwardRef((a,d)=>{let{__scopeRadio:e,name:f,checked:g=!1,required:j,disabled:l,value:m="on",onCheck:n,form:o,...p}=a,[q,r]=c.useState(null),s=(0,i.useComposedRefs)(d,a=>r(a)),t=c.useRef(!1),u=!q||o||!!q.closest("form");return(0,b.jsxs)(M,{scope:e,checked:g,disabled:l,children:[(0,b.jsx)(k.Primitive.button,{type:"button",role:"radio","aria-checked":g,"data-state":S(g),"data-disabled":l?"":void 0,disabled:l,value:m,...p,ref:s,onClick:(0,h.composeEventHandlers)(a.onClick,a=>{g||n?.(),u&&(t.current=a.isPropagationStopped(),t.current||a.stopPropagation())})}),u&&(0,b.jsx)(R,{control:q,bubbles:!t.current,name:f,value:m,checked:g,required:j,disabled:l,form:o,style:{transform:"translateX(-100%)"}})]})});O.displayName=J;var P="RadioIndicator",Q=c.forwardRef((a,c)=>{let{__scopeRadio:d,forceMount:e,...f}=a,g=N(P,d);return(0,b.jsx)(I.Presence,{present:e||g.checked,children:(0,b.jsx)(k.Primitive.span,{"data-state":S(g.checked),"data-disabled":g.disabled?"":void 0,...f,ref:c})})});Q.displayName=P;var R=c.forwardRef(({__scopeRadio:a,control:d,checked:e,bubbles:f=!0,...g},h)=>{let j=c.useRef(null),l=(0,i.useComposedRefs)(j,h),m=(0,H.usePrevious)(e),n=(0,G.useSize)(d);return c.useEffect(()=>{let a=j.current;if(!a)return;let b=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(m!==e&&b){let c=new Event("click",{bubbles:f});b.call(a,e),a.dispatchEvent(c)}},[m,e,f]),(0,b.jsx)(k.Primitive.input,{type:"radio","aria-hidden":!0,defaultChecked:e,...g,tabIndex:-1,ref:l,style:{...g.style,...n,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function S(a){return a?"checked":"unchecked"}R.displayName="RadioBubbleInput";var T=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],U="RadioGroup",[V,W]=(0,j.createContextScope)(U,[x,L]),X=x(),Y=L(),[Z,$]=V(U),_=c.forwardRef((a,c)=>{let{__scopeRadioGroup:d,name:e,defaultValue:f,value:g,required:h=!1,disabled:i=!1,orientation:j,dir:l,loop:m=!0,onValueChange:n,...q}=a,r=X(d),s=(0,p.useDirection)(l),[t,u]=(0,o.useControllableState)({prop:g,defaultProp:f??null,onChange:n,caller:U});return(0,b.jsx)(Z,{scope:d,name:e,required:h,disabled:i,value:t,onValueChange:u,children:(0,b.jsx)(A,{asChild:!0,...r,orientation:j,dir:s,loop:m,children:(0,b.jsx)(k.Primitive.div,{role:"radiogroup","aria-required":h,"aria-orientation":j,"data-disabled":i?"":void 0,dir:s,...q,ref:c})})})});_.displayName=U;var aa="RadioGroupItem",ab=c.forwardRef((a,d)=>{let{__scopeRadioGroup:e,disabled:f,...g}=a,j=$(aa,e),k=j.disabled||f,l=X(e),m=Y(e),n=c.useRef(null),o=(0,i.useComposedRefs)(d,n),p=j.value===g.value,q=c.useRef(!1);return c.useEffect(()=>{let a=a=>{T.includes(a.key)&&(q.current=!0)},b=()=>q.current=!1;return document.addEventListener("keydown",a),document.addEventListener("keyup",b),()=>{document.removeEventListener("keydown",a),document.removeEventListener("keyup",b)}},[]),(0,b.jsx)(D,{asChild:!0,...l,focusable:!k,active:p,children:(0,b.jsx)(O,{disabled:k,required:j.required,checked:p,...m,...g,name:j.name,ref:o,onCheck:()=>j.onValueChange(g.value),onKeyDown:(0,h.composeEventHandlers)(a=>{"Enter"===a.key&&a.preventDefault()}),onFocus:(0,h.composeEventHandlers)(g.onFocus,()=>{q.current&&n.current?.click()})})})});ab.displayName=aa;var ac=c.forwardRef((a,c)=>{let{__scopeRadioGroup:d,...e}=a,f=Y(d);return(0,b.jsx)(Q,{...f,...e,ref:c})});ac.displayName="RadioGroupIndicator";let ad=(0,a.i(70106).default)("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var ae=a.i(97895);let af=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(_,{className:(0,ae.cn)("grid gap-2",a),...c,ref:d}));af.displayName=_.displayName;let ag=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(ab,{ref:d,className:(0,ae.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),...c,children:(0,b.jsx)(ac,{className:"flex items-center justify-center",children:(0,b.jsx)(ad,{className:"h-2.5 w-2.5 fill-current text-current"})})}));ag.displayName=ab.displayName;var ah=a.i(5050),ai=(0,ah.createServerReference)("4092236c67afa3346a320374b8c3df1fa7187b9005",ah.callServer,void 0,ah.findSourceMapURL,"createOrder"),aj=a.i(97848);function ak({user:a,addresses:h,cartItems:i,total:j}){let k=(0,d.useRouter)(),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)(h[0]?.id?.toString()||"new"),[p,q]=(0,c.useState)("razorpay"),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(!1);async function x(b,c){if(!t||!r||!window.Razorpay)return void alert("Payment system is not ready. Please try again.");m(!0);try{let d=await fetch("/api/razorpay/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:j,orderId:b})}),e=await d.json();if(!d.ok)throw Error(e.error||"Failed to create payment order");let f={key:r,amount:e.amount,currency:e.currency,name:"NIVARA",description:`Order ${c}`,order_id:e.id,handler:async a=>{try{let c=await fetch("/api/razorpay/verify-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpay_order_id:a.razorpay_order_id,razorpay_payment_id:a.razorpay_payment_id,razorpay_signature:a.razorpay_signature,orderId:b})});await c.json(),c.ok?(k.push(`/orders/${b}`),k.refresh()):alert("Payment verification failed. Please contact support.")}catch(a){alert("Payment verification failed. Please contact support.")}finally{m(!1)}},modal:{ondismiss:()=>{m(!1)}},prefill:{name:a.full_name,email:a.email},theme:{color:"#B29789"}},g=new window.Razorpay(f);g.on("payment.failed",a=>{alert(`Payment failed: ${a.error.description}`),m(!1)}),g.open()}catch(a){alert(a.message||"Payment failed. Please try again."),m(!1)}}async function y(a){let b;a.preventDefault(),m(!0);let c=new FormData(a.currentTarget),d=null;if("new"===n)b={address_line1:c.get("address_line1"),address_line2:c.get("address_line2"),city:c.get("city"),state:c.get("state"),postal_code:c.get("postal_code"),country:"India"};else{let a=h.find(a=>a.id.toString()===n);a&&(d=a.id,b={address_line1:a.address_line1,address_line2:a.address_line2,city:a.city,state:a.state,postal_code:a.postal_code,country:a.country})}let e=await ai({items:i.map(a=>({productId:a.product_id,quantity:a.quantity,price:Number.parseFloat(a.price)})),shippingAddress:b,shippingAddressId:d,paymentMethod:p,totalAmount:j});e.error?(alert(e.error),m(!1)):e.orderId&&e.orderNumber&&await x(e.orderId,e.orderNumber)}return(0,c.useEffect)(()=>{let a=document.createElement("script");return a.src="https://checkout.razorpay.com/v1/checkout.js",a.async=!0,a.onload=()=>{u(!0)},a.onerror=()=>{w(!0)},document.body.appendChild(a),(0,aj.getRazorpayPublicKey)().then(a=>{s(a)}),()=>{document.body.contains(a)&&document.body.removeChild(a)}},[]),(0,b.jsxs)("form",{onSubmit:y,className:"space-y-8",children:[(0,b.jsxs)("div",{className:"bg-card border rounded-lg p-6 space-y-4",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold",children:"Contact Information"}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"name",children:"Full Name"}),(0,b.jsx)(f.Input,{id:"name",defaultValue:a.full_name,readOnly:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"email",children:"Email"}),(0,b.jsx)(f.Input,{id:"email",type:"email",defaultValue:a.email,readOnly:!0})]})]})]}),(0,b.jsxs)("div",{className:"bg-card border rounded-lg p-6 space-y-4",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold",children:"Shipping Address"}),h.length>0&&(0,b.jsxs)(af,{value:n,onValueChange:o,children:[h.map(a=>(0,b.jsxs)("div",{className:"flex items-start space-x-2 border rounded p-3",children:[(0,b.jsx)(ag,{value:a.id.toString(),id:`address-${a.id}`}),(0,b.jsxs)(g.Label,{htmlFor:`address-${a.id}`,className:"flex-1 cursor-pointer",children:[(0,b.jsx)("div",{className:"font-medium",children:a.address_line1}),a.address_line2&&(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:a.address_line2}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:[a.city,", ",a.state," ",a.postal_code]}),a.is_default&&(0,b.jsx)("span",{className:"text-xs bg-primary/10 text-primary px-2 py-1 rounded mt-1 inline-block",children:"Default"})]})]},a.id)),(0,b.jsxs)("div",{className:"flex items-start space-x-2 border rounded p-3",children:[(0,b.jsx)(ag,{value:"new",id:"address-new"}),(0,b.jsx)(g.Label,{htmlFor:"address-new",className:"cursor-pointer",children:"Use a new address"})]})]}),"new"===n&&(0,b.jsxs)("div",{className:"space-y-4 pt-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"address_line1",children:"Address Line 1 *"}),(0,b.jsx)(f.Input,{id:"address_line1",name:"address_line1",required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"address_line2",children:"Address Line 2"}),(0,b.jsx)(f.Input,{id:"address_line2",name:"address_line2"})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"city",children:"City *"}),(0,b.jsx)(f.Input,{id:"city",name:"city",required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"state",children:"State *"}),(0,b.jsx)(f.Input,{id:"state",name:"state",required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"postal_code",children:"Postal Code *"}),(0,b.jsx)(f.Input,{id:"postal_code",name:"postal_code",required:!0})]})]})]})]}),(0,b.jsxs)("div",{className:"bg-card border rounded-lg p-6 space-y-4",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold",children:"Payment Method"}),(0,b.jsx)(af,{value:p,onValueChange:q,children:(0,b.jsxs)("div",{className:"flex items-center space-x-2 border rounded p-3",children:[(0,b.jsx)(ag,{value:"razorpay",id:"payment-razorpay"}),(0,b.jsxs)(g.Label,{htmlFor:"payment-razorpay",className:"flex-1 cursor-pointer",children:[(0,b.jsx)("div",{className:"font-medium",children:"Online"}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Secure online payment via Razorpay"})]})]})})]}),(0,b.jsx)(e.Button,{type:"submit",size:"lg",className:"w-full",disabled:l||!t||v,children:l?"Processing...":"Place Order"}),(v||!t)&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:v?"Payment system failed to load.":"Payment system is loading..."})]})}a.s(["CheckoutForm",()=>ak],63640)}];

//# sourceMappingURL=components_checkout-form_tsx_334dc5ae._.js.map